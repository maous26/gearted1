services:
  - type: static_site
    name: gearted-web-app
    env: flutter
    plan: free
    autoDeploy: true
    branch: main
    buildFilter:
      paths:
      - "gearted-mobile/**"
      - "render.yaml"
    headers:
      - path: "/*"
        name: "Cache-Control"
        value: "no-cache, no-store, must-revalidate"
    routes:
      - type: rewrite
        source: "/*"
        destination: "/index.html"
    buildCommand: |
      # STEP 1: Create the directory Render expects BEFORE the build starts.
      # This is the critical fix for the "Service Root Directory missing" error.
      mkdir -p flutter-build

      # STEP 2: Install Flutter
      echo "Installing Flutter..."
      apt-get update && apt-get install -y --no-install-recommends git unzip xz-utils zip libglu1-mesa
      git clone https://github.com/flutter/flutter.git --depth 1 --branch 3.22.2 /opt/flutter
      export PATH="$PATH:/opt/flutter/bin"
      flutter doctor -v

      # STEP 3: Build the Flutter app
      echo "Building Flutter app..."
      cd gearted-mobile
      flutter pub get
      flutter build web --release --web-renderer canvaskit

      # STEP 4: Move the built assets to the directory Render expects
      echo "Moving build artifacts to publish directory..."
      mv build/web/* ../flutter-build/

    # This is the directory Render will serve the static files from.
    publishPath: flutter-build