services:
  - type: static_site
    name: gearted-web-app
    env: flutter
    plan: free
    autoDeploy: true
    branch: main
    # Set the root directory to the Flutter project
    rootDir: gearted-mobile
    buildFilter:
      paths:
      - "gearted-mobile/**"
      - "render.yaml"
    headers:
      - path: "/*"
        name: "Cache-Control"
        value: "no-cache, no-store, must-revalidate"
    routes:
      - type: rewrite
        source: "/*"
        destination: "/index.html"
    buildCommand: |
      # STEP 1: Install Flutter
      # The working directory is now /opt/render/project/src/gearted-mobile
      echo "Installing Flutter..."
      apt-get update && apt-get install -y --no-install-recommends git unzip xz-utils zip libglu1-mesa
      git clone https://github.com/flutter/flutter.git --depth 1 --branch 3.22.2 /opt/flutter
      export PATH="$PATH:/opt/flutter/bin"
      flutter doctor -v

      # STEP 2: Build the Flutter app
      # We are already in the gearted-mobile directory, so no 'cd' is needed.
      echo "Building Flutter app..."
      flutter pub get
      flutter build web --release --web-renderer canvaskit

      # STEP 3: Move the built assets to the publish directory
      # The publishPath is relative to the repo root, so we move the files
      # to the parent directory's 'flutter-build' folder.
      echo "Moving build artifacts to publish directory..."
      mv build/web ../flutter-build

    # This path is relative to the repository root, NOT the rootDir.
    publishPath: flutter-build